<!DOCTYPE html>
<html lang="pl" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core.biz.pl - Bitcoin Intelligence Platform</title>
    <meta name="description" content="Zaawansowany explorer Bitcoin, analiza kwantowa i narzędzia rynkowe.">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- GLOBALNE STYLE --- */
        :root {
            --btc-orange: #F7931A;
            --bg-dark: #0d1117; /* GitHub Dark Dimmed */
            --card-bg: #161b22;
            --border-col: #30363d;
            --text-main: #c9d1d9;
            --neon-green: #2ea043;
            --neon-red: #da3633;
        }

        body { font-family: 'Segoe UI', 'Roboto', monospace; background-color: var(--bg-dark); color: var(--text-main); }
        
        /* Navbar */
        .navbar { background-color: #010409 !important; border-bottom: 1px solid var(--border-col); }
        .dropdown-menu { background-color: var(--card-bg); border: 1px solid var(--border-col); }
        .dropdown-item { color: var(--text-main); }
        .dropdown-item:hover { background-color: var(--btc-orange); color: #fff; }

        /* Karty */
        .card { background-color: var(--card-bg); border: 1px solid var(--border-col); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .card-header { background-color: rgba(255,255,255,0.02); border-bottom: 1px solid var(--border-col); font-weight: 600; letter-spacing: 1px; }

        /* Ceny */
        .source-title { color: var(--btc-orange); font-weight: 800; font-size: 0.8rem; letter-spacing: 1px; }

        /* Metrics */
        .metric-box { text-align: center; padding: 15px; border-radius: 8px; background: rgba(255,255,255,0.03); }
        .metric-value { font-size: 1.8rem; font-weight: bold; }
        .metric-label { font-size: 0.8rem; color: #8b949e; text-transform: uppercase; }

        /* Explorer Tools */
        .expert-json { background-color: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 0.8rem; max-height: 200px; overflow-y: auto; display: none; border: 1px solid #333; }
        .qr-container canvas { border: 5px solid #fff; border-radius: 5px; }
        
        /* Quantum Section - Raport Techniczny */
        .quantum-report-box {
            background: linear-gradient(45deg, #1a0505 0%, #121212 100%);
            border: 1px solid #842029;
        }
        .quantum-alert { background-color: #2c0b0e; border: 1px solid #842029; color: #ea868f; }
        .quantum-safe { background-color: #0b2c14; border: 1px solid #0f5132; color: #75b798; }

        /* Linki */
        .satoshi-link { color: var(--btc-orange); cursor: pointer; text-decoration: underline; text-decoration-style: dotted; }
        .satoshi-link:hover { color: #fff; }
        
        .loader { display: inline-block; width: 1rem; height: 1rem; border: 2px solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spinner-border .75s linear infinite; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fa-brands fa-bitcoin" style="color: #F7931A;"></i> CORE.BIZ.PL
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mainNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard"><i class="fa-solid fa-gauge-high"></i> Dashboard</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-screwdriver-wrench"></i> Narzędzia
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#explorer"><i class="fa-solid fa-magnifying-glass"></i> Explorer & QR</a></li>
                            <li><a class="dropdown-item" href="#converter"><i class="fa-solid fa-calculator"></i> Konwerter Sats</a></li>
                            <li><hr class="dropdown-divider" style="border-color: #444;"></li>
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#glossaryModal"><i class="fa-solid fa-book"></i> Słownik Pojęć</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-graduation-cap"></i> Edukacja
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#history">Ewolucja Adresów</a></li>
                            <li><a class="dropdown-item" href="#zombies">Zombie Coins</a></li>
                            <li><a class="dropdown-item" href="#quantum-deep" style="color: #ea868f;"><i class="fa-solid fa-atom"></i> Zagrożenie Kwantowe</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="ms-3 text-secondary small d-none d-lg-block border-start border-secondary ps-3">
                    <i class="fa-regular fa-clock"></i> <span id="last-update">...</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4" id="dashboard">
        <div class="row mb-4 g-3">
            <div class="col-md-6 col-lg-3">
                <div class="metric-box border border-warning">
                    <div class="metric-label"><i class="fa-solid fa-hourglass-half text-warning"></i> Halving (Szac.)</div>
                    <div class="metric-value text-warning" id="halving-days">...</div>
                    <small class="text-secondary">Dni do 2028 r.</small>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="metric-box border border-secondary">
                    <div class="metric-label"><i class="fa-solid fa-gauge"></i> Fear & Greed</div>
                    <div class="metric-value" id="fng-value">...</div>
                    <small id="fng-text" class="text-secondary">...</small>
                </div>
            </div>
            <div class="col-md-12 col-lg-6">
                <div class="metric-box border border-secondary d-flex justify-content-around align-items-center h-100">
                    <div class="text-center">
                        <div class="source-title">BINANCE</div>
                        <div id="price-binance" class="fw-bold fs-5">...</div>
                    </div>
                    <div class="text-center border-start border-secondary ps-4 pe-4">
                        <div class="source-title">KRAKEN</div>
                        <div id="price-kraken" class="fw-bold fs-5">...</div>
                    </div>
                    <div class="text-center border-start border-secondary ps-4">
                        <div class="source-title">COINBASE</div>
                        <div id="price-coinbase" class="fw-bold fs-5">...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-5">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fa-solid fa-chart-area text-warning"></i> Analiza Techniczna (7 Dni)</span>
                <span class="badge bg-dark border border-secondary">CoinGecko API</span>
            </div>
            <div class="card-body">
                <canvas id="btcChart" style="max-height: 400px; width: 100%;"></canvas>
                
                <div class="row mt-4 pt-3 border-top border-secondary text-center">
                    <div class="col-12 mb-2"><span class="badge bg-dark text-secondary border border-secondary">MEMPOOL FEES (sat/vB)</span></div>
                    <div class="col-4">
                        <h4 class="text-danger fw-bold" id="fee-high">-</h4>
                        <small class="text-secondary">High (~10m)</small>
                    </div>
                    <div class="col-4 border-start border-secondary">
                        <h4 class="text-warning fw-bold" id="fee-mid">-</h4>
                        <small class="text-secondary">Medium (~30m)</small>
                    </div>
                    <div class="col-4 border-start border-secondary">
                        <h4 class="text-success fw-bold" id="fee-low">-</h4>
                        <small class="text-secondary">Low (>1h)</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5" id="converter">
        <div class="card border-secondary">
            <div class="card-header"><i class="fa-solid fa-calculator text-success"></i> Szybki Kalkulator</div>
            <div class="card-body">
                <div class="row g-3 align-items-center">
                    <div class="col-md-5">
                        <label class="small text-secondary">Kwota w USD</label>
                        <input type="number" id="calc-usd" class="form-control bg-dark text-light border-secondary" placeholder="np. 100">
                    </div>
                    <div class="col-md-2 text-center">
                        <i class="fa-solid fa-arrow-right-arrow-left text-secondary fa-xl mt-4"></i>
                    </div>
                    <div class="col-md-5">
                        <label class="small text-secondary">Satoshi (sats)</label>
                        <input type="number" id="calc-sats" class="form-control bg-dark text-light border-secondary" placeholder="wynik...">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5" id="explorer">
        <div class="p-4 bg-dark border border-secondary rounded-3 shadow">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="display-6 fw-bold text-warning mb-0"><i class="fa-solid fa-magnifying-glass"></i> Explorer</h2>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="expertToggle">
                    <label class="form-check-label small text-secondary" for="expertToggle">Tryb Eksperta (JSON)</label>
                </div>
            </div>
            
            <div class="input-group mb-3 input-group-lg">
                <input type="text" class="form-control bg-dark text-light border-secondary" placeholder="Wklej adres BTC (np. 1A1z...)" id="searchInput">
                <button class="btn btn-warning fw-bold" type="button" id="btnSearch">ANALIZUJ</button>
            </div>
            
            <div id="explorer-result" class="d-none animate-fade-in">
                <div class="row" id="pdf-content">
                    <div class="col-lg-8 mb-3">
                        <div class="card h-100 bg-secondary bg-opacity-10 border-secondary">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <h5 class="text-warning">Portfel On-Chain</h5>
                                    <button class="btn btn-sm btn-outline-light" onclick="generatePDF()"><i class="fa-solid fa-file-pdf"></i> PDF</button>
                                </div>
                                <p class="text-break font-monospace bg-black p-2 rounded border border-dark mb-3 small" id="res-address"></p>
                                
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="mb-2">Saldo BTC: <strong id="res-balance" class="fs-4"></strong></div>
                                        <div class="mb-2">Wartość USD: <strong id="res-balance-usd" class="text-success"></strong></div>
                                        <div class="mb-2">Transakcji: <span id="res-txs"></span></div>
                                        <div class="mb-2 text-secondary small">Otrzymano łącznie: <span id="res-received"></span> BTC</div>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        <div id="qrcode" class="qr-container d-flex justify-content-center"></div>
                                        <small class="text-muted d-block mt-2">Zeskanuj, aby wpłacić</small>
                                    </div>
                                </div>
                                
                                <div id="json-viewer" class="expert-json mt-3"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4 mb-3">
                        <div class="card h-100" id="quantum-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fa-solid fa-shield-cat"></i> Audyt Kwantowy</h5>
                                <div id="quantum-status-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="explorer-error" class="alert alert-danger d-none mt-3"></div>
        </div>
    </div>

    <div class="container mb-5" id="history">
        <div class="row">
            <div class="col-md-6 mb-4">
                <h5 class="text-secondary border-bottom border-secondary pb-2">Ewolucja Adresów</h5>
                <div class="accordion accordion-flush" id="accordionAddresses">
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header"><button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#addr1">2009: P2PK (Podatny)</button></h2>
                        <div id="addr1" class="accordion-collapse collapse" data-bs-parent="#accordionAddresses"><div class="accordion-body text-secondary small">Klucz publiczny jawny w Blockchainie. Bardzo niebezpieczny.</div></div>
                    </div>
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header"><button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#addr2">2010: P2PKH (Legacy)</button></h2>
                        <div id="addr2" class="accordion-collapse collapse" data-bs-parent="#accordionAddresses"><div class="accordion-body text-secondary small">Wprowadzenie hashowania (SHA-256). Bezpieczny do momentu wydania środków.</div></div>
                    </div>
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header"><button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#addr3">2017: SegWit (Nowoczesny)</button></h2>
                        <div id="addr3" class="accordion-collapse collapse" data-bs-parent="#accordionAddresses"><div class="accordion-body text-secondary small">Oddzielenie podpisów (Witness). Tańsze transakcje, format bc1q...</div></div>
                    </div>
                    <div class="accordion-item bg-dark text-light border-secondary">
                        <h2 class="accordion-header"><button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#addr4">2021: Taproot (Prywatny)</button></h2>
                        <div id="addr4" class="accordion-collapse collapse" data-bs-parent="#accordionAddresses"><div class="accordion-body text-secondary small">Podpisy Schnorra i MAST. Zwiększona prywatność i skalowalność.</div></div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-4" id="zombies">
                <h5 class="text-secondary border-bottom border-secondary pb-2">Zombie Coins</h5>
                <div class="card bg-dark border-secondary">
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-3">
                                <i class="fa-solid fa-user-secret text-warning"></i> <strong>Satoshi Nakamoto:</strong><br>
                                <span class="satoshi-link small font-monospace" onclick="checkSatoshi()">1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</span>
                                <span class="badge bg-danger ms-2">P2PK</span>
                            </li>
                            <li class="small text-secondary">
                                <i class="fa-solid fa-trash-can"></i> Szacuje się, że 3-4 mln BTC jest utracone na zawsze (zgubione klucze, spalone dyski).
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5" id="quantum-deep">
        <div class="p-4 rounded quantum-report-box">
            <h3 class="text-danger mb-4"><i class="fa-solid fa-microchip"></i> Zagrożenie Kwantowe: Raport Techniczny</h3>
            
            <div class="row">
                <div class="col-md-8">
                    <p class="text-secondary">
                        Obecne szyfrowanie Bitcoina (Krzywe Eliptyczne ECDSA) opiera się na trudności matematycznej odnalezienia klucza prywatnego na podstawie publicznego. 
                        Komputery kwantowe używające <strong>Algorytmu Shora</strong> teoretycznie mogą rozwiązać ten problem.
                    </p>
                    <div class="alert alert-dark border-secondary">
                        <strong class="text-success"><i class="fa-solid fa-shield-cat"></i> Dlaczego Hashing chroni nowe adresy?</strong><br>
                        <span class="text-secondary">
                            W nowoczesnych adresach (od P2PKH w górę), sieć nie widzi Twojego Klucza Publicznego, lecz jego <strong>Hash</strong> (skrót kryptograficzny SHA-256 + RIPEMD-160). 
                            Algorytm Shora potrafi łamać krzywe eliptyczne, ale <strong>nie potrafi odwracać funkcji skrótu (Hash)</strong>. 
                            Dopiero w momencie, gdy wysyłasz transakcję, musisz ujawnić Klucz Publiczny, aby sieć mogła sprawdzić podpis. Do tego momentu, komputer kwantowy nie ma danych wejściowych, by Cię zaatakować.
                        </span>
                    </div>
                </div>
                <div class="col-md-4 text-end d-none d-md-block">
                    <i class="fa-solid fa-atom text-danger opacity-25" style="font-size: 8rem;"></i>
                </div>
            </div>

            <hr class="border-danger opacity-25">

            <div class="row mt-4">
                <div class="col-md-6">
                    <h5 class="text-light mb-3"><i class="fa-solid fa-layer-group text-danger"></i> Etapy Ataku</h5>
                    <div class="text-secondary">
                        <div class="mb-4">
                            <strong class="text-warning d-block mb-1">ETAP 1: Stare Adresy (P2PK)</strong>
                            Główne zagrożenie dotyczy adresów z lat 2009-2010 (w tym Satoshiego), gdzie klucz publiczny jest zapisany wprost w łańcuchu bloków. Komputer kwantowy używający Algorytmu Shora może efektywnie wyliczyć z niego klucz prywatny, łamiąc krzywą eliptyczną secp256k1 w relatywnie krótkim czasie, bez wiedzy właściciela.
                        </div>
                        <div>
                            <strong class="text-light d-block mb-1">ETAP 2: Atak "W Locie" (Front-Running)</strong>
                            Dla nowych adresów (P2PKH/SegWit) klucz publiczny jest ujawniany dopiero w momencie wysyłania transakcji. Aby ukraść środki, atakujący musiałby przechwycić transakcję w Mempoolu, wyliczyć klucz prywatny i wysłać własną transakcję z wyższą opłatą (RBF) zanim górnik wydobędzie blok (średnio 10 minut). To wymagałoby mocy obliczeniowej o rzędy wielkości większej niż Etap 1.
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 border-start border-secondary">
                    <h5 class="text-light mb-3"><i class="fa-solid fa-shield-halved text-success"></i> Obrona Społeczności</h5>
                    <div class="text-secondary">
                        <div class="mb-4">
                            <strong class="text-success d-block mb-1">Migracja Post-Kwantowa (Soft-Fork)</strong>
                            Społeczność Bitcoin obserwuje rozwój technologii. W razie realnego zagrożenia zostanie wprowadzony Soft-Fork dodający nowe typy podpisów odpornych na kwanty (PQ), np. podpisy oparte na kratach (Lattice-based) lub jednorazowe podpisy Lamporta. Użytkownicy po prostu prześlą środki na nowe typy adresów, zabezpieczając je nową kryptografią.
                        </div>
                        <div>
                            <strong class="text-success d-block mb-1">Technika Commit-Reveal</strong>
                            Jako dodatkową warstwę ochrony można wymusić schemat "zobowiązania". Najpierw sieć akceptuje tylko Hash transakcji (bezpieczny, bo SHA-256 jest odporne na Shora). Dopiero gdy Hash zostanie utrwalony w bloku, użytkownik ujawnia klucz i podpis. Uniemożliwia to atak "w locie", ponieważ atakujący nie może zmienić transakcji, która została już "zaklepana" przez górników.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="glossaryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content bg-dark border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-warning">Słownik Pojęć</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-secondary">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item bg-dark text-light border-secondary"><strong>Satoshi (Sat):</strong> Najmniejsza jednostka Bitcoina. 1 BTC = 100,000,000 sat.</li>
                        <li class="list-group-item bg-dark text-light border-secondary"><strong>Mempool:</strong> "Poczekalnia" dla transakcji, które nie zostały jeszcze dodane do bloku.</li>
                        <li class="list-group-item bg-dark text-light border-secondary"><strong>Halving:</strong> Zmniejszenie nagrody dla górników o połowę (co 4 lata).</li>
                        <li class="list-group-item bg-dark text-light border-secondary"><strong>P2PK:</strong> Pay To Public Key - stary, niebezpieczny typ adresu.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center text-secondary py-4 border-top border-secondary mt-5">
        <div class="container small">
            <p class="mb-1">&copy; 2025 Core.biz.pl v6.0</p>
            <p>Dane: Mempool.space | CoinGecko | Binance | Alternative.me</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        // --- ZMIENNE GLOBALNE ---
        let currentBtcPrice = 0;
        const formatUSD = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);

        // --- FUNKCJE ---
        async function updateHalving() {
            try {
                const res = await fetch('https://mempool.space/api/blocks/tip/height');
                const height = parseInt(await res.text());
                const nextHalvingBlock = 1050000;
                const daysLeft = Math.floor((nextHalvingBlock - height) * 10 / 60 / 24);
                document.getElementById('halving-days').innerText = daysLeft;
            } catch(e) {}
        }

        async function fetchFnG() {
            try {
                const res = await fetch('https://api.alternative.me/fng/');
                const data = await res.json();
                const val = data.data[0].value;
                const elVal = document.getElementById('fng-value');
                elVal.innerText = val;
                if(val < 25) elVal.className = "metric-value text-danger";
                else if(val > 75) elVal.className = "metric-value text-success";
                else elVal.className = "metric-value text-warning";
                document.getElementById('fng-text').innerText = data.data[0].value_classification;
            } catch(e) {}
        }

        async function fetchPrices() {
            try {
                let res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                let data = await res.json();
                currentBtcPrice = parseFloat(data.price);
                document.getElementById('price-binance').innerText = formatUSD(currentBtcPrice);
            } catch(e) {}
            try {
                let res = await fetch('https://api.coinbase.com/v2/prices/BTC-USD/spot');
                let data = await res.json();
                document.getElementById('price-coinbase').innerText = formatUSD(parseFloat(data.data.amount));
            } catch(e) {}
            try {
                let res = await fetch('https://api.kraken.com/0/public/Ticker?pair=XBTUSD');
                let data = await res.json();
                let key = Object.keys(data.result)[0];
                document.getElementById('price-kraken').innerText = formatUSD(parseFloat(data.result[key].c[0]));
            } catch(e) {}
            try {
                let res = await fetch('https://mempool.space/api/v1/fees/recommended');
                let fees = await res.json();
                document.getElementById('fee-high').innerText = fees.fastestFee;
                document.getElementById('fee-mid').innerText = fees.halfHourFee;
                document.getElementById('fee-low').innerText = fees.hourFee;
            } catch(e) {}
            document.getElementById('last-update').innerText = new Date().toLocaleTimeString();
        }

        async function loadChart() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=7');
                const data = await res.json();
                const prices = data.prices.map(item => item[1]);
                const dates = data.prices.map(item => {
                    const d = new Date(item[0]);
                    return d.getDate() + '/' + (d.getMonth()+1) + ' ' + d.getHours() + ':00';
                });
                const ctx = document.getElementById('btcChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: 'BTC Price',
                            data: prices,
                            borderColor: '#F7931A',
                            backgroundColor: 'rgba(247, 147, 26, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            pointRadius: 0,
                            tension: 0.2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        interaction: { intersect: false, mode: 'index' },
                        scales: { y: { grid: { color: '#222' }, ticks: { color: '#666' } }, x: { display: false } }
                    }
                });
            } catch(e) {}
        }

        // --- NARZĘDZIA ---
        const calcUsd = document.getElementById('calc-usd');
        const calcSats = document.getElementById('calc-sats');
        calcUsd.addEventListener('input', () => { if(currentBtcPrice > 0) calcSats.value = Math.floor((parseFloat(calcUsd.value) / currentBtcPrice) * 100000000); });
        calcSats.addEventListener('input', () => { if(currentBtcPrice > 0) calcUsd.value = ((parseFloat(calcSats.value) / 100000000) * currentBtcPrice).toFixed(2); });

        function checkSatoshi() {
            document.getElementById('searchInput').value = "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa";
            window.location.href = "#explorer";
            document.getElementById('btnSearch').click();
        }

        function generatePDF() {
            const element = document.getElementById('pdf-content');
            html2pdf().set({ margin: 10, filename: 'bitcoin_report.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' } }).from(element).save();
        }

        document.getElementById('expertToggle').addEventListener('change', function() { document.getElementById('json-viewer').style.display = this.checked ? 'block' : 'none'; });

        // --- EXPLORER CORE ---
        document.getElementById('btnSearch').addEventListener('click', async () => {
            const address = document.getElementById('searchInput').value.trim();
            const resBox = document.getElementById('explorer-result');
            const errBox = document.getElementById('explorer-error');
            const qrDiv = document.getElementById('qrcode');
            
            resBox.classList.add('d-none'); errBox.classList.add('d-none'); qrDiv.innerHTML = "";
            if (!address) return;
            const btn = document.getElementById('btnSearch'); btn.innerText = "ANALIZA..."; btn.disabled = true;

            try {
                const response = await fetch(`https://mempool.space/api/address/${address}`);
                if (!response.ok) throw new Error("Nie znaleziono adresu.");
                const data = await response.json();
                
                const balanceBTC = (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / 100000000;
                document.getElementById('res-address').innerText = address;
                document.getElementById('res-balance').innerText = balanceBTC.toFixed(8) + " BTC";
                document.getElementById('res-balance-usd').innerText = formatUSD(balanceBTC * currentBtcPrice);
                document.getElementById('res-txs').innerText = data.chain_stats.tx_count;
                
                new QRCode(qrDiv, { text: address, width: 100, height: 100 });

                const isSatoshi = address === "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa";
                const spentCount = data.chain_stats.spent_txo_count;
                const qCard = document.getElementById('quantum-card');
                const qContent = document.getElementById('quantum-status-content');

                if (spentCount > 0 || isSatoshi) {
                    qCard.className = "card h-100 quantum-alert";
                    qContent.innerHTML = `<h6 class="fw-bold">KLUCZ UJAWNIONY (Etap 1)</h6><p class="small">Adres wykonał transakcję lub jest publicznie znany (Genesis).</p><hr><strong>RYZYKO WYSOKIE</strong>`;
                } else {
                    qCard.className = "card h-100 quantum-safe";
                    qContent.innerHTML = `<h6 class="fw-bold">KLUCZ ZABEZPIECZONY</h6><p class="small">Klucz publiczny ukryty za hashem (SHA-256).</p><hr><strong>BEZPIECZNY</strong>`;
                }
                document.getElementById('json-viewer').innerText = JSON.stringify(data, null, 2);
                resBox.classList.remove('d-none');
            } catch (err) { errBox.innerText = err.message; errBox.classList.remove('d-none'); } finally { btn.innerText = "ANALIZUJ"; btn.disabled = false; }
        });

        // INIT
        fetchFnG(); updateHalving(); fetchPrices(); loadChart(); setInterval(fetchPrices, 60000);
    </script>
</body>
</html>